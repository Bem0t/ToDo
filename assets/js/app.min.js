(() => {
  "use strict";
  let addMessage = document.querySelector(".controls__inp"),
    addButton = document.querySelector(".controls__btn"), todoA = document.querySelector(".todo"),
    todoH = document.querySelector('.todo-h');
  let todoList = [];
  const todoid = document.querySelector(".id").textContent;
  console.log(todoid)
  //Сохранение данных в localstorage
  if (localStorage.getItem(todoid)) {
    todoList = JSON.parse(localStorage.getItem(todoid));
    displayMessagesH();
  }
  //Добавление объекта в массив и вызов вывода
  addButton.addEventListener("click", function () {
    let newTodo = {
      todo: addMessage.value,
      checked: false,
    }
    todoList.push(newTodo);
    displayMessagesA();
    displayMessagesH();
    localStorage.setItem(todoid, JSON.stringify(todoList));
  });
  //вывод текущего листа
  function displayMessagesA() {
    let displayMessage = "";
    todoList.forEach(function (item, i) {
      displayMessage += `
    <li>
    <label >${item.todo}</label>
    </li>
    `;
      todoA.innerHTML = displayMessage;
    })
  }
  //Вывод всего листа 
  function displayMessagesH() {
    let displayMessage = "";
    if (todoList.length === 0) {
      todoH.innerHTML = ""
      todoA.innerHTML = ""
    };
    todoList.forEach(function (item, i) {
      displayMessage += `
    <li>
    <input type='checkbox' id='item_${i}' ${item.checked ? 'checked' : ''}>
    <label for = 'item_${i}'>${item.todo}</label>
    </li>
    `;
      todoH.innerHTML = displayMessage;
    })
  }
  //Сохранение значения checked при выводе
  todoH.addEventListener('change', function (event) {
    let idInput = event.target.getAttribute('id');
    let forLabel = todoH.querySelector('[for=' + idInput + "]");
    let valueLabel = forLabel.innerHTML;
    todoList.forEach(function (item) {
      if (item.todo === valueLabel)
        item.checked = !item.checked;
      localStorage.setItem(todoid, JSON.stringify(todoList));
    })
  })

  //Удаление из списка (ctrl+правая кнопка мыши)
  todoH.addEventListener('contextmenu', function (event) {
    event.preventDefault();
    todoList.forEach(function (item, i) {
      if (item.todo === event.target.innerHTML) {
        if (event.ctrlKey) {
          todoList.splice(i, 1);
        }
        displayMessagesH();
        displayMessagesA();
        localStorage.setItem(todoid, JSON.stringify(todoList));
      }
    })
  })
})();